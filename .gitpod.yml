github:
  prebuilds:
    master: true
    branches: true
    pullRequests: true
    pullRequestsFromForks: true
    addCheck: true
    addComment: false
    addBadge: true

tasks:
  - name: Nextcloud Server
    command: |
      git config core.fileMode false
      chmod -R 777 .
      cd gitpod
      export SIMPLESAML_URL=$(gp url 8082)/simplesaml
      export NEXTCLOUD_URL=$(gp url 8080)
      sudo apt install -y gettext
      envsubst < mariadb/prepopulate.sql.template > mariadb/prepopulate.sql
      envsubst < simplesamlphp/var-simplesamlphp/metadata/saml20-sp-remote.php.template > simplesamlphp/var-simplesamlphp/metadata/saml20-sp-remote.php
      docker-compose up

  - name: Terminal
    command: clear

ports:
  - port: 8080
    onOpen: open-browser
    visibility: private
  - port: 8081
    visibility: private
    onOpen: ignore
  - port: 8082
    visibility: private
    onOpen: ignore

github:
  prebuilds:
    master: true
    branches: true
    pullRequests: true
    pullRequestsFromForks: true
    addCheck: true
    addComment: false
    addBadge: true

tasks:
  - name: Nextcloud Server
    command: |
      git config core.fileMode false
      chmod -R 777 .
      cd gitpod
      export SIMPLESAML_URL=https://8082-${GITPOD_WORKSPACE_URL#https://}/simplesaml/
      export NEXTCLOUD_URL=https://8080-${GITPOD_WORKSPACE_URL#https://}/
      sudo apt install -y gettext
      envsubst < mariadb/prepopulate.sql.template > mariadb/prepopulate.sql
      docker-compose up

  - name: Terminal
    command: clear

ports:
  - port: 8080
    onOpen: open-browser
    visibility: private
  - port: 8081
    visibility: private
    onOpen: ignore
